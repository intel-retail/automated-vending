


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>Device Services - Automated Checkout</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#device-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Automated Checkout" class="md-header-nav__button md-logo" aria-label="Automated Checkout">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Automated Checkout
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Device Services
            
          </span>
        </div>
      
    </div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Automated Checkout" class="md-nav__button md-logo" aria-label="Automated Checkout">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Automated Checkout
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Automated Checkout Reference Design" class="md-nav__link">
      Automated Checkout Reference Design
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Phases
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phases" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Phases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../phases/phase1.html" title="Phase 1 - Simulation Mode" class="md-nav__link">
      Phase 1 - Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../phases/phase2.html" title="Phase 2 - Add Card Reader Device" class="md-nav__link">
      Phase 2 - Add Card Reader Device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../phases/phase3.html" title="Phase 3 - Bring Your Own Hardware and Software" class="md-nav__link">
      Phase 3 - Bring Your Own Hardware and Software
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Additional Documentation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Additional Documentation" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Additional Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      Automated Checkout Services
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Automated Checkout Services" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Automated Checkout Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Device Services
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="device_services.html" title="Device Services" class="md-nav__link md-nav__link--active">
      Device Services
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#list-of-device-services" class="md-nav__link">
    List of device services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#card-reader" class="md-nav__link">
    Card reader
  </a>
  
    <nav class="md-nav" aria-label="Card reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-device-functionality" class="md-nav__link">
    Physical Device Functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apis" class="md-nav__link">
    APIs
  </a>
  
    <nav class="md-nav" aria-label="APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-card-readercard-reader-event" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost48098apiv1devicenameds-card-readercard-reader-status" class="md-nav__link">
    GET: http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-board" class="md-nav__link">
    Controller board
  </a>
  
    <nav class="md-nav" aria-label="Controller board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_1" class="md-nav__link">
    Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-device-functionality_1" class="md-nav__link">
    Physical Device Functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apis_1" class="md-nav__link">
    APIs
  </a>
  
    <nav class="md-nav" aria-label="APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandlock1" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/lock1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandlock2" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/lock2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommanddisplayrow0" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/displayRow0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandsettemperature" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/setTemperature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandsethumidity" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/setHumidity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandsetdoorclosed" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/setDoorClosed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inference-mock" class="md-nav__link">
    Inference mock
  </a>
  
    <nav class="md-nav" aria-label="Inference mock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_2" class="md-nav__link">
    Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apis_2" class="md-nav__link">
    APIs
  </a>
  
    <nav class="md-nav" aria-label="APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost48098apiv1devicenameinference-mqtt-devicecommandinferenceheartbeat" class="md-nav__link">
    GET: http://localhost:48098/api/v1/device/name/Inference-MQTT-device/command/inferenceHeartbeat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48100apiv1devicenameinference-mqtt-devicecommandinferencedoorstatus" class="md-nav__link">
    PUT: http://localhost:48100/api/v1/device/name/Inference-MQTT-device/command/inferenceDoorStatus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="application_services.html" title="Application Services" class="md-nav__link">
      Application Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="micro_services.html" title="Other Microservices" class="md-nav__link">
      Other Microservices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../events.html" title="Automated Checkout Events" class="md-nav__link">
      Automated Checkout Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration.html" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modifying_source_code.html" title="Modifying source code" class="md-nav__link">
      Modifying source code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../notifications.html" title="How to Send Notifications through EdgeX (optional)" class="md-nav__link">
      How to Send Notifications through EdgeX (optional)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../references.html" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../troubleshooting.html" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#list-of-device-services" class="md-nav__link">
    List of device services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#card-reader" class="md-nav__link">
    Card reader
  </a>
  
    <nav class="md-nav" aria-label="Card reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-device-functionality" class="md-nav__link">
    Physical Device Functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apis" class="md-nav__link">
    APIs
  </a>
  
    <nav class="md-nav" aria-label="APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-card-readercard-reader-event" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost48098apiv1devicenameds-card-readercard-reader-status" class="md-nav__link">
    GET: http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-board" class="md-nav__link">
    Controller board
  </a>
  
    <nav class="md-nav" aria-label="Controller board">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_1" class="md-nav__link">
    Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-device-functionality_1" class="md-nav__link">
    Physical Device Functionality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apis_1" class="md-nav__link">
    APIs
  </a>
  
    <nav class="md-nav" aria-label="APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandlock1" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/lock1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandlock2" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/lock2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommanddisplayrow0" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/displayRow0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandsettemperature" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/setTemperature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandsethumidity" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/setHumidity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48098apiv1devicenameds-controller-boardcommandsetdoorclosed" class="md-nav__link">
    PUT: http://localhost:48098/api/v1/device/name/ds-controller-board/command/setDoorClosed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inference-mock" class="md-nav__link">
    Inference mock
  </a>
  
    <nav class="md-nav" aria-label="Inference mock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_2" class="md-nav__link">
    Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apis_2" class="md-nav__link">
    APIs
  </a>
  
    <nav class="md-nav" aria-label="APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-httplocalhost48098apiv1devicenameinference-mqtt-devicecommandinferenceheartbeat" class="md-nav__link">
    GET: http://localhost:48098/api/v1/device/name/Inference-MQTT-device/command/inferenceHeartbeat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-httplocalhost48100apiv1devicenameinference-mqtt-devicecommandinferencedoorstatus" class="md-nav__link">
    PUT: http://localhost:48100/api/v1/device/name/Inference-MQTT-device/command/inferenceDoorStatus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="device-services">Device Services</h1>
<p>The <strong>Automated Checkout</strong> reference design utilizes three device services that are used to communicate hardware event data to underlying EdgeX framework.</p>
<h2 id="list-of-device-services">List of device services</h2>
<ul>
<li>Card reader – Handles the interface between an RFID card reader and EdgeX.</li>
<li>Controller board – Handles the interface between Arduino firmware and EdgeX.</li>
<li>Inference mock –  Mock that mimics an actual computer vision inference.</li>
</ul>
<h2 id="card-reader">Card reader</h2>
<h3 id="description">Description</h3>
<p>The <code>ds-card-reader</code> device service is an EdgeX device service that allows a USB-based RFID card reader to grant access to the Automated Checkout. At a high level, this device service is responsible for discovering a specific card reader device, watching for input from that device, parsing that input, and then forwarding the input into the EdgeX framework.</p>
<p>There are two different modes available to this device service:</p>
<ol>
<li><strong>Physical Mode:</strong> for use with a physical controller board device</li>
<li><strong>Virtual Mode:</strong> used when simulating a physical controller board by using a RESTful endpoint</li>
</ol>
<p>The EdgeX Core services are required for the <code>ds-card-reader</code> to publish the card ID into the EdgeX bus (zeroMQ). Without the EdgeX core services, this device service will not function.</p>
<h3 id="physical-device-functionality">Physical Device Functionality</h3>
<p>The <code>ds-card-reader</code> service is much simpler than the <code>ds-controller-board</code> service, because it only requires mounting <code>/dev/input:/dev/input</code> at runtime. However, it still requires root privileges in the container at runtime so that it can interact directly with event/USB drivers.</p>
<h3 id="apis">APIs</h3>
<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-card-readercard-reader-event"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-event</code></h4>
<p>The <code>PUT</code> API endpoint will push the badge ID (which is sent as part of the API request body) into the card reader device service. Once the card reader device service receives the badge ID, the badge ID will be pushed into the EdgeX bus for other application services to utilize.</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;card-reader-event&quot;:&quot;0003278200&quot;}&#39;</span> http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-event
</code></pre></div>


<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<hr />
<h4 id="get-httplocalhost48098apiv1devicenameds-card-readercard-reader-status"><code>GET</code>: <code>http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-status</code></h4>
<p>The <code>GET</code> API endpoint returns data that is not meant to be consumed for any particular purpose. When triggering this endpoint, it will execute a function (in the Go source code) called <code>CardReaderStatus</code> that is used as an auto-remediation mechanism to attempt to "grab" the physical card reader HID device (via <a href="https://en.wikipedia.org/wiki/Evdev"><code>evdev</code></a>). If it succeeds in grabbing the underlying device, that means that the <code>ds-card-reader</code> device service has lost its hold on the card reader, and we need to restart the service. This endpoint is meant to be hit frequently.</p>
<div class="codehilite"><pre><span></span><code>curl -X GET http://localhost:48098/api/v1/device/name/ds-card-reader/card-reader-status
</code></pre></div>


<p>Sample response:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;ds-card-reader&quot;</span><span class="p">,</span><span class="nt">&quot;origin&quot;</span><span class="p">:</span><span class="mi">1579130994896</span><span class="p">}</span>
</code></pre></div>


<hr />
<h2 id="controller-board">Controller board</h2>
<h3 id="description_1">Description</h3>
<p>The <code>ds-controller-board</code> device service is responsible for handling communication with a custom-built Arduino micro-controller board (or virtual board if you don't have physical hardware). It provides functionality for reading the lock status, door status, temperature, and humidity readings, while also sending commands to the controller board to unlock the mag-lock, and display output to the LCD.</p>
<p>There are two different modes available for this device service:</p>
<ol>
<li><strong>Physical Mode:</strong> for use with a physical controller board device</li>
<li><strong>Virtual Mode:</strong> used when simulating a physical controller board by using a RESTful endpoint</li>
</ol>
<h3 id="physical-device-functionality_1">Physical Device Functionality</h3>
<p>When not running in simulated mode (i.e. a physical controller board device is plugged into your system), the <code>ds-controller-board</code> Docker container service requires <code>/dev/ttyACM0</code>, which is the typically the default serial port for an Arduino microcontroller.</p>
<p>This may change if you have multiple serial devices plugged in. Please ensure that <code>/dev/ttyACM0</code> maps to the appropriate serial device if you plan to run the <code>ds-controller-board</code> service with a physical device.</p>
<p>It is important to note that the <code>ds-controller-board</code> service <em>is</em> capable of automatically finding a TTY port <em>aside</em> from <code>/dev/ttyACM0</code>. It actually looks for the vendor and product ID (VID/PID) values specified in the service's configuration. The problems arise when we have to mount the TTY port via Docker:</p>
<ul>
<li>mounting <code>/dev:/dev</code> to the container at runtime solves the problem, but creates security risks and requires <code>--privileged=true</code> on the container, which is bad practice and can lead to security issues</li>
<li>mounting <code>/dev/ttyACM0:/dev/ttyACM0</code> solves the problem, assuming there is only one serial device</li>
</ul>
<p>Therefore, if you have multiple serial devices plugged into your system, please manually edit the <code>docker-compose.yml</code> file to mount your <code>/dev/ttyACM_X_</code> appropriately. You may want to explore creating udev rules to enforce TTY consistency.</p>
<h3 id="apis_1">APIs</h3>
<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-controller-boardcommandlock1"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-controller-board/command/lock1</code></h4>
<p>This <code>PUT</code> command will operate magnetic <code>lock1</code>. Depending on the numeric value of <code>lock1</code> (boolean <code>0/1</code>), the lock state will either be locked or unlocked.</p>
<p>Simple usage example:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock1&quot;:&quot;0&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/ds-controller-board/command/lock1
</code></pre></div>


<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock1&quot;:&quot;0&quot;}&#39;</span> http://localhost:48097/api/v1/device/name/ds-controller-board/lock1
</code></pre></div>


<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-controller-boardcommandlock2"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-controller-board/command/lock2</code></h4>
<p>This <code>PUT</code> command will operate magnetic <code>lock2</code>. Depending on the numeric value of <code>lock2</code> (boolean <code>0/1</code>), the lock state will either be locked or unlocked.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently <code>lock2</code> has no purpose. During the initial architect/design phase of Automated Checkout, there were two locks. This was later reduced to a single mag-lock.</p>
</div>
<p>Sample usage:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock2&quot;:&quot;1&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/ds-controller-board/command/lock2
</code></pre></div>


<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;lock2&quot;:&quot;1&quot;}&#39;</span> http://localhost:48097/api/v1/device/name/ds-controller-board/lock2
</code></pre></div>


<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-controller-boardcommanddisplayrow0"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-controller-board/command/displayRow0</code></h4>
<p>This <code>PUT</code> command will operate the display (LCD) and control the text to be put on the first line of the display.</p>
<p>Simple usage :</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;displayRow0&quot;:&quot;The Earth is round&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/ds-controller-board/command/displayRow0
</code></pre></div>


<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;displayRow0&quot;:&quot;The Earth is round&quot;}&#39;</span> http://localhost:48097/api/v1/device/name/ds-controller-board/displayRow0
</code></pre></div>


<div class="admonition info">
<p class="admonition-title">Info</p>
<p>On the endpoint URL, Change displayRow<strong>0</strong> index to 1, 2, or 3 to display and control the text to be put on the second, third, and forth line accordingly.</p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-controller-boardcommandsettemperature"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-controller-board/command/setTemperature</code></h4>
<p>This <code>PUT</code> command will emulate the temperature sensed by the controller board as a persistent value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>setTemperature</em> is a float64. Any non-float64 value will be interpreted as '0.00' (do not have to specify decimal values).</p>
</div>
<p>Simple usage :</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setTemperature&quot;:&quot;12.00&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/ds-controller-board/command/setTemperature
</code></pre></div>


<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setTemperature&quot;:&quot;12.00&quot;}&#39;</span> http://localhost:48097/api/v1/device/name/ds-controller-board/setTemperature
</code></pre></div>


<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-controller-boardcommandsethumidity"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-controller-board/command/setHumidity</code></h4>
<p>This <code>PUT</code> command will emulate the humidity sensed by the controller board as a persistent value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>setHumidity</em> is an integer. Any non-integer value will be interpreted as '0'.</p>
</div>
<p>Simple usage example:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setHumidity&quot;:&quot;12&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/ds-controller-board/command/setHumidity
</code></pre></div>


<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setHumidity&quot;:&quot;12&quot;}&#39;</span> http://localhost:48097/api/v1/device/name/ds-controller-board/setHumidity
</code></pre></div>


<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h4 id="put-httplocalhost48098apiv1devicenameds-controller-boardcommandsetdoorclosed"><code>PUT</code>: <code>http://localhost:48098/api/v1/device/name/ds-controller-board/command/setDoorClosed</code></h4>
<p>This <code>PUT</code> command will emulate the "door-closed" state sensed by the controller board as a persistent value.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>setDoorClosed</em> is a boolean-integer. Any non-boolean-integer value will be interpreted as '0' (and thus 'false'). Only '1' will result in 'true'.</p>
</div>
<p>Simple usage example:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setDoorClosed&quot;:&quot;0&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/ds-controller-board/command/setDoorClosed
</code></pre></div>


<p>This will make the request directly to the device service itself instead of proxying through the EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;setDoorClosed&quot;:&quot;0&quot;}&#39;</span> http://localhost:48097/api/v1/device/name/ds-controller-board/setDoorClosed
</code></pre></div>


<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Response Status Code 400 Bad Request</p>
</div>
<hr />
<h2 id="inference-mock">Inference mock</h2>
<h3 id="description_2">Description</h3>
<p>The <code>ds-inference-mock</code> device service contains two components:</p>
<ul>
<li>A Python implementation of the Automated Checkout inference mock that mimics an actual computer vision inference mechanism by returning a random set of inventory "deltas" after a brief waiting period</li>
<li>An <a href="https://github.com/edgexfoundry/device-mqtt-go">EdgeX MQTT device service</a> that converts MQTT messages into EdgeX event readings</li>
</ul>
<p>The Automated Checkout architecture uses three MQTT topics:</p>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inference/CommandTopic</td>
<td>All events pushed from EdgeX's command API are fed into this topic. The <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-vending"><code>as-vending</code></a> and <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-controller-board-status"><code>as-controller-board-status</code></a> are two services that make requests to this API, typically for making door close/open and heartbeat events.</td>
</tr>
<tr>
<td>Inference/ResponseTopic</td>
<td>The Automated Checkout inference mock will respond to published messages on the <code>Inference/CommandTopic</code> topic on the <code>Inference/ResponseTopic</code> topic.</td>
</tr>
<tr>
<td>Inference/DataTopic</td>
<td>The inference mock publishes delta SKUs on this topic, then the MQTT device service converts them into EdgeX event readings, and finally the <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-vending"><code>as-vending</code></a> service processes the event readings and pushes them to downstream services.</td>
</tr>
</tbody>
</table>
<h3 id="apis_2">APIs</h3>
<hr />
<h4 id="get-httplocalhost48098apiv1devicenameinference-mqtt-devicecommandinferenceheartbeat"><code>GET</code>: <code>http://localhost:48098/api/v1/device/name/Inference-MQTT-device/command/inferenceHeartbeat</code></h4>
<p>The <code>GET</code> call to the EdgeX MQTT device service's <code>inferenceHearbeat</code> command will act as a health-check for the Automated Checkout inferencing service. It must return <code>200 OK</code> upon swiping an RFID card in order for the vending workflow to begin. If it does not, the <a href="https://github.com/intel-iot-devkit/automated-checkout/blob/master/as-vending"><code>as-vending</code></a> service will enter maintenance mode.</p>
<p>Simple usage example:</p>
<p>Through EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET http://localhost:48082/api/v1/device/name/Inference-MQTT-device/command/inferenceHeartbeat
</code></pre></div>


<p>To MQTT device service itself:</p>
<div class="codehilite"><pre><span></span><code>curl -X GET http://localhost:48100/api/v1/device/name/Inference-MQTT-device/inferenceHeartbeat
</code></pre></div>


<p>Sample response, <code>200 OK</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;Inference-MQTT-device&quot;</span><span class="p">,</span>
    <span class="nt">&quot;origin&quot;</span><span class="p">:</span> <span class="mi">1579637607912</span><span class="p">,</span>
    <span class="nt">&quot;readings&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;origin&quot;</span><span class="p">:</span> <span class="mi">1579637607911</span><span class="p">,</span>
            <span class="nt">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;Inference-MQTT-device&quot;</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;inferenceHeartbeat&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;inferencePong&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<hr />
<h4 id="put-httplocalhost48100apiv1devicenameinference-mqtt-devicecommandinferencedoorstatus"><code>PUT</code>: <code>http://localhost:48100/api/v1/device/name/Inference-MQTT-device/command/inferenceDoorStatus</code></h4>
<p>The <code>PUT</code> call to the EdgeX MQTT device service's <code>inferenceDoorStatus</code> command will cause the inference mock to consume the message, and if the JSON <code>PUT</code> key <code>inferenceDoorStatus</code> has the string value <code>"true"</code>, an inference attempt will begin. The mock will subsequently respond with a message containing the inventory delta (aka SKU delta).</p>
<p>Simple usage example:</p>
<p>Through EdgeX command API:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -d <span class="s1">&#39;{&quot;inferenceDoorStatus&quot;:&quot;true&quot;}&#39;</span> http://localhost:48082/api/v1/device/name/Inference-MQTT-device/command/inferenceDoorStatus
</code></pre></div>


<p>To MQTT device service itself:</p>
<div class="codehilite"><pre><span></span><code>curl -X PUT -d <span class="s1">&#39;{&quot;inferenceDoorStatus&quot;:&quot;true&quot;}&#39;</span> http://localhost:48100/api/v1/device/name/Inference-MQTT-device/inferenceDoorStatus
</code></pre></div>


<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Response Status Code 200 OK.</p>
</div>
<hr />
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../phases/phase3.html" title="Phase 3 - Bring Your Own Hardware and Software" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Phase 3 - Bring Your Own Hardware and Software
              </div>
            </div>
          </a>
        
        
          <a href="application_services.html" title="Application Services" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Application Services
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/lunr/lunr.js"></script>
      
    
  </body>
</html>